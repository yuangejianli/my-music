<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.css">
<script src="https://cdn.jsdelivr.net/npm/colorthief@2.3.2/dist/color-thief.umd.js"></script>

<style>
body {
  margin: 15px;
  background: transparent;
}

/* 极简 */
.aplayer {
  border: none !important;
  box-shadow: none !important;
  background: #fff;
  border-radius: 0 !important;
  --zinnia-theme: #e9e99;
}

.aplayer .aplayer-info,
.aplayer .aplayer-list,
.aplayer .aplayer-list ol li {
  border: none !important;
}

/* 固定高度 */
.aplayer .aplayer-list {
  max-height: 78px !important;
  overflow: hidden !important;
}

.aplayer .aplayer-list ol {
  max-height: 78px !important;
  overflow-y: auto !important;
  margin: 0 !important;
  padding: 0 !important;
  scroll-behavior: auto !important;
}

/* 行高 */
.aplayer .aplayer-list ol li {
  height: 26px !important;
  line-height: 26px !important;
  padding: 0 15px !important;
  font-size: 12px !important;

  display: flex !important;
  align-items: center !important;
}

.aplayer .aplayer-list-title {
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}

/* 高亮 */
.aplayer-list-light {
  background: #f4f4f4 !important;
}

/* 小竖条 */
.aplayer-list-cur {
  display: none !important;
}

.aplayer-list-light .aplayer-list-cur {
  display: block !important;
  width: 2px !important;
  height: 16px !important;
  background: var(--zinnia-theme) !important;
}
</style>
</head>

<body>

<div id="aplayer"></div>

<script src="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.js"></script>

<script>

const audioList = [
  {
    name: 'Her Silence',
    artist: '何真真',
    url: 'music/何真真 - Her Silence.mp3',
    cover: 'cover/何真真 - Her Silence.jpg'
  },
  {
    name: 'Hurricanes',
    artist: 'Dido',
    url: 'music/Dido - Hurricanes.mp3',
    cover: 'cover/Dido - Hurricanes.jpg'
  },
  {
    name: 'Everytime you kissed me',
    artist: 'FictionJunction',
    url: 'music/FictionJunction - Everytime you kissed me.mp3',
    cover: 'cover/FictionJunction - Everytime you kissed me.jpg'
  },
  {
    name: '沙尘的彼方',
    artist: 'FictionJunction',
    url: 'music/FictionJunction - 沙尘的彼方.mp3',
    cover: 'cover/FictionJunction - 沙尘的彼方.jpg'
  }
];

const ap = new APlayer({
  container: document.getElementById('aplayer'),
  listFolded: false,
  listMaxHeight: 78,
  audio: audioList,
  theme: '#e9e9e9'
});

const colorThief = new ColorThief();

/* 等封面加载完再取色 */
function updateTheme() {

  const index = ap.list.index;
  const cover = audioList[index]?.cover;

  if (!cover) return;

  const img = new Image();
  img.crossOrigin = 'anonymous';

  img.onload = () => {

    try {
      const color = colorThief.getColor(img);
      const rgb = `rgb(${color[0]},${color[1]},${color[2]})`;

      ap.theme(rgb, index);
      ap.container.style.setProperty('--zinnia-theme', rgb);

    } catch(e) {}
  };

  img.src = cover;
}


/* 用官方方法滚动 */
function fixScroll() {

  ap.list.switch(ap.list.index);

}


/* 切歌完成后再执行 */
ap.on('play', () => {

  updateTheme();

  setTimeout(fixScroll, 80);

});


/* 初始化 */
window.onload = () => {

  setTimeout(() => {

    updateTheme();
    fixScroll();

  }, 400);

};

</script>

</body>
</html>
